package simplify.controller;

import java.io.File;
import java.io.IOException;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.apache.commons.lang.StringUtils;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import simplify.client.bpd.BpdController;
import simplify.reports.DBClient;
import simplify.utils.CustomLogger;
import simplify.utils.DataHandler;
import simplify.utils.HttpConnectionUtils;
import simplify.utils.SimplifyCache;
import simplify.utils.property.DatabasePropertyReader;

public class SimplifyDashboardController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private static CustomLogger logger = new CustomLogger();
	private String className = this.getClass().getSimpleName();

	public SimplifyDashboardController() {
        super();
        // TODO Auto-generated constructor stub
    }

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		logger.info("IN:: SimplifyDashboardController", className);		
		String action = request.getParameter("action");
		
		if ("viewDetails".equalsIgnoreCase(action)) {
			String operation = request.getParameter("operation");
			String envi = request.getParameter("envi");
			request.setAttribute("operation", operation);
			request.setAttribute("envi", envi);
			request.setAttribute("action", "viewDetails");
			RequestDispatcher requestDispatcher = request.getRequestDispatcher("pages/function/"+operation+".jsp");
			requestDispatcher.forward(request, response);
		} else if("download".equals(action)) {
			String report = request.getParameter("report");
			String workDir = request.getParameter("workdir");
			RequestDispatcher dispatcher = request.getRequestDispatcher("pages/download.jsp?report="+report+"&workdir="+ workDir);
			dispatcher.forward(request, response);
		} else if("file-sharing".equalsIgnoreCase(action)) {
			System.out.println("test"+action);
			RequestDispatcher dispatcher = request.getRequestDispatcher("pages/file-sharing.jsp");
			dispatcher.forward(request, response);
		}
		else if("Deployment".equalsIgnoreCase(action)) {
			System.out.println("test"+action);
			RequestDispatcher dispatcher = request.getRequestDispatcher("pages/hotfix.jsp");
			dispatcher.forward(request, response);
		}else {
			RequestDispatcher dispatcher = request.getRequestDispatcher("pages/index.jsp");
			dispatcher.forward(request, response);
		}
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		logger.info("IN:: SimplifyDashboardController - post", className);
		String action = request.getParameter("action");
		if("refreshDashboard".equalsIgnoreCase(action)) {
			SimplifyCache instance = SimplifyCache.getInstance();
			HashMap<String, JSONObject> map = instance.getDashboardMap();
			JSONObject output = new JSONObject(map);			
			response.setContentType("application/json");
		    response.setCharacterEncoding("UTF-8");
		    response.getWriter().write(output.toString());
		} else if("refreshCharts".equalsIgnoreCase(action)) {
			SimplifyCache instance = SimplifyCache.getInstance();
			HashMap<String, JSONObject> map = instance.getChartMap();
			JSONObject output = new JSONObject(map);		
			logger.info("output:: "+output, className);
			response.setContentType("application/json");
		    response.setCharacterEncoding("UTF-8");
		    response.getWriter().write(output.toString());
		    
		} else if("refreshTables".equalsIgnoreCase(action)) {
			SimplifyCache instance = SimplifyCache.getInstance();
			HashMap<String, JSONObject> map = instance.getTableInfoMap();
			JSONObject output = new JSONObject(map);	
			logger.info("output:: "+output, className);
			response.setContentType("application/json");
		    response.setCharacterEncoding("UTF-8");
		    response.getWriter().write(output.toString());
		} 
		else if("checkServerStatus".equals(action)) {
			String envi = request.getParameter("envi");
			JSONObject output = new JSONObject();
			try {
				HttpConnectionUtils con = new HttpConnectionUtils();
				output.put("serverStatus", con.getHTTPServerStatus(envi));
				DateFormat dateFormat = new SimpleDateFormat("MMM dd, hh:mm a");
				Date date = new Date();
				output.put("date", dateFormat.format(date));
				output.put("status", "success");
			} catch(Exception e) {
				logger.error("Exception in checkServerStatus"+e.getLocalizedMessage(),className);
				try {
					output.put("status", "failed");
				} catch (JSONException e1) {
					logger.error("Exception in checkServerStatus"+e.getLocalizedMessage(),className);
				}
			}
			
			response.setContentType("application/json");
		    response.setCharacterEncoding("UTF-8");
		    response.getWriter().write(output.toString());
		} else if ("viewDetails".equals(action)) {
			String operation = request.getParameter("operation");
			String envi = request.getParameter("envi");
			logger.info("operation:: "+operation, action);
			try {
				BpdController bpdController =  new BpdController(envi);
				JSONObject value = bpdController.getHandleErrorApplications();
				JSONArray appLst = value.getJSONArray("appLst");
				ArrayList<String> list = new ArrayList<String>();
			    int size = appLst.length();
			    for (int i = 0; i < size; i++) {
			        list.add("'"+appLst.getString(i)+"'");
			    }
				DBClient client = new DBClient(envi);
				logger.info("list:: "+list, className);
				JSONObject table = client.populateTable(operation,"single",StringUtils.join(list.toArray(), ','), true);
//				JSONObject table = new JSONObject("{     \"value\": {         \"recordLst\": [             [                 \"1100003171468\",                 \"17733057\",                 \"CC_Bank\",                 \"****\",                 \"                              \",                 null,                 \"HDFC Bank\",                 \"27391\",                 \"Annual\",                 \"10000000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100000055631\",                 \"90161211\",                 \"HA_PolicyIssuance\",                 \"Mbr Suspense Amt is less than Required Prem Amt   \",                 \"0                            \",                 null,                 \"HDFC Bank\",                 \"13889\",                 \"Annual\",                 \"500000\",                 \"2015-09-14 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100000110836\",                 \"90099236\",                 \"HA_PolicyIssuance\",                 \"Mbr Suspense Amt is less than Required Prem Amt   \",                 \"0                            \",                 null,                 \"Agency\",                 \"13415\",                 \"Annual\",                 \"300000\",                 \"2015-09-08 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100008788932\",                 \"90153730\",                 \"HA_PolicyIssuance\",                 \"Mbr Suspense Amt is less than Required Prem Amt   \",                 \"0                            \",                 null,                 \"Agency\",                 \"12759\",                 \"Annual\",                 \"300000\",                 \"2015-09-02 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2200004682066\",                 \"90136828\",                 \"HA_PolicyIssuance\",                 \"Mbr Suspense Amt is less than Required Prem Amt   \",                 \"0                            \",                 null,                 \"Online\",                 \"23129\",                 \"Annual\",                 \"500000\",                 \"2015-09-10 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100008846467\",                 \"90160106\",                 \"HA_PolicyIssuance\",                 \"Mbr Suspense Amt is less than Required Prem Amt   \",                 \"0                            \",                 null,                 \"HDFC Bank\",                 \"4017\",                 \"Annual\",                 \"300000\",                 \"2015-09-11 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100009191629\",                 \"90160869\",                 \"HA_PolicyIssuance\",                 \"Mbr Suspense Amt is less than Required Prem Amt   \",                 \"0                            \",                 null,                 \"Agency\",                 \"12070\",                 \"Annual\",                 \"300000\",                 \"2015-09-14 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100007963886\",                 \"90143528\",                 \"HA_DataCapture - 56661741\",                 \"J5B6-CLNTNUM                                     \",                 \"0JL76No prop attched to clnt \",                 null,                 \"Agency\",                 \"18470\",                 \"Annual\",                 \"300000\",                 \"2015-09-14 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100007396578\",                 \"17798534\",                 \"1811473-LA_DataCapture\",                 \"SJ5BB-ZQTYD                                       \",                 \"1H045Must be > Zero          \",                 null,                 \"Agency\",                 \"14188\",                 \"Annual\",                 \"2500000\",                 \"2015-09-11 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-11 00:00:00.0\"             ],             [                 \"2100000037310\",                 null,                 \"HA ProposalSetup\",                 \"S9106-AGE                                        \",                 \"Age < Min age allowed   \",                 null,                 \"HDFC Bank\",                 \"5639\",                 \"Annual\",                 \"300000\",                 \"2015-09-08 00:00:00.0\",                 \"HA-InitialSetup\",                 \"2015-09-09 00:00:00.0\"             ],             [                 \"2100008852095\",                 null,                 \"HA ProposalSetup\",                 \"S9103-GAGNTSEL                                   \",                 \"Agent not Auth for Prod \",                 null,                 \"DNA\",                 \"10421\",                 \"Annual\",                 \"1000000\",                 \"2015-09-14 00:00:00.0\",                 \"HA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100008853697\",                 null,                 \"HA ProposalSetup\",                 \"S9103-GAGNTSEL                                   \",                 \"Agent not Auth for Prod \",                 null,                 \"DNA\",                 \"7352\",                 \"Annual\",                 \"1000000\",                 \"2015-09-14 00:00:00.0\",                 \"HA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100008046208\",                 null,                 \"HA ProposalSetup\",                 \"S9103-GAGNTSEL                                   \",                 \"Agent not Auth for Prod \",                 null,                 \"Agency\",                 \"537\",                 \"Annual\",                 \"1000000\",                 \"2015-09-12 00:00:00.0\",                 \"HA-InitialSetup\",                 \"2015-09-12 00:00:00.0\"             ],             [                 \"2100008799455\",                 \"90156057\",                 \"SI/ECS_Mandate\",                 \"I020\",                 \"Bank A/C Not Effective  0S3281-BANKACCKEY                                  \",                 null,                 \"Direct\",                 \"2615\",                 \"Annual\",                 \"1000000\",                 \"2015-09-05 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-10 00:00:00.0\"             ],             [                 \"2100008780835\",                 \"90155328\",                 \"SI/ECS_Mandate\",                 \"I020\",                 \"Bank A/C Not Effective  0S3281-BANKACCKEY                                  \",                 null,                 \"Agency\",                 \"6735\",                 \"Annual\",                 \"500000\",                 \"2015-09-04 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-10 00:00:00.0\"             ],             [                 \"1100008015545\",                 \"17832494\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Benf Minor.Entr Apointe \",                 null,                 \"HDFC Bank\",                 \"25000\",                 \"Annual\",                 \"250000\",                 \"2015-08-28 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100004299312\",                 null,                 \"HA ProposalSetup\",                 \"SR9UG-GHEIGHT                                    \",                 \"Both fields or neither  \",                 null,                 \"Agency\",                 \"11830\",                 \"Annual\",                 \"300000\",                 \"2015-08-17 00:00:00.0\",                 \"HA-InitialSetup\",                 \"2015-09-07 00:00:00.0\"             ],             [                 \"1100003172002\",                 \"17734990\",                 \"953973-PERS_CLNT_UPDT\",                 \"S2480-CLTTWO                                      \",                 \"Client has been merged  \",                 null,                 \"Agency\",                 \"12531\",                 \"Annual\",                 \"2500000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"3100008842811\",                 \"17874383\",                 \"2215208-PERS_CLNT_UPDT\",                 \"S2480-CLTTWO                                      \",                 \"Client has been merged  \",                 null,                 \"Ratnakar Bank\",                 \"100000\",                 \"Annual\",                 \"379295\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100007914825\",                 \"17815134\",                 \"1904777-PERS_CLNT_UPDT\",                 \"S2480-CLTTWO                                      \",                 \"Client has been merged  \",                 null,                 \"HDFC Bank\",                 \"24000\",                 \"Annual\",                 \"168000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100007839100\",                 \"17818845\",                 \"1877713-PERS_CLNT_UPDT\",                 \"S2480-CLTTWO                                      \",                 \"Client has been merged  \",                 null,                 \"HDFC Bank\",                 \"50000\",                 \"Annual\",                 \"350000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008053717\",                 \"17831389\",                 \"NEFT_Mandate\",                 \"Z914\",                 \"Enter CC Dummy details  0SR595-BANKACCKEY                                  \",                 null,                 \"HDFC Securities\",                 \"25000\",                 \"Annual\",                 \"175000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2200009218156\",                 null,                 \"2292503- PERS_CLNT_CREAT\",                 \"H366\",                 \"Field cannot be blank   0S2465-CLTSEX                                      \",                 null,                 \"Online\",                 \"29099\",                 \"Annual\",                 \"700000\",                 \"2015-09-14 00:00:00.0\",                 \"HA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1200000008827\",                 null,                 null,                 \"E186\",                 \"Field must be entered   0S2465-INDPIN                                      \",                 null,                 \"Online\",                 \"805\",                 \"Monthly\",                 \"2500000\",                 \"2015-09-11 00:00:00.0\",                 \"Initial LA SetUP\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2200000008212\",                 null,                 null,                 \"E186\",                 \"Field must be entered   0S2465-INDPIN                                      \",                 null,                 \"Online\",                 \"11216\",                 \"Annual\",                 \"300000\",                 \"2015-09-11 00:00:00.0\",                 \"Initial LA SetUP\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100000414544\",                 \"17720075\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Mandate Is Not Effective\",                 null,                 \"Defence\",                 \"2156\",                 \"Monthly\",                 \"199000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"3100006818078\",                 \"17827886\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Outside TH611 Prem Limit\",                 null,                 \"Direct\",                 \"6000\",                 \"Quarterly\",                 \"601215\",                 \"2015-08-22 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-09 00:00:00.0\"             ],             [                 \"1100002661054\",                 \"17746431\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"Agency\",                 \"19788\",                 \"Annual\",                 \"10000000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100004374813\",                 \"17758057\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"HDFC Bank\",                 \"31000\",                 \"Annual\",                 \"217000\",                 \"2015-09-11 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100004375170\",                 \"17756018\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"Agency\",                 \"24753\",                 \"Annual\",                 \"298914\",                 \"2015-09-10 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100004435028\",                 \"17876047\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"HDFC Bank\",                 \"50000\",                 \"Annual\",                 \"203550\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100007381067\",                 \"17800362\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"HDFC Bank\",                 \"100000\",                 \"Annual\",                 \"489336\",                 \"2015-09-12 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100009193596\",                 \"17874486\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"HDFC Bank\",                 \"19324\",                 \"Annual\",                 \"114587\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008216075\",                 \"17842619\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"DSC\",                 \"29000\",                 \"Annual\",                 \"180570\",                 \"2015-09-11 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008790079\",                 \"17855935\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"HDFC Bank\",                 \"100000\",                 \"Annual\",                 \"1000000\",                 \"2015-09-11 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008796320\",                 \"17857616\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"HDFC Sales\",                 \"13000\",                 \"Annual\",                 \"98210\",                 \"2015-09-03 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100007918623\",                 \"17866315\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem+cont amts > Susp   \",                 null,                 \"HDFC Bank\",                 \"100000\",                 \"Annual\",                 \"417415\",                 \"2015-09-09 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008796459\",                 \"17856907\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Prem>Limit,Inc proof req\",                 null,                 \"HDFC Bank\",                 \"100000\",                 \"Annual\",                 \"1000000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100004400505\",                 \"90135681\",                 \"HA_ProposalUpdate\",                 \"SK498-RDOCNUM                                    \",                 \"Receipt not posted\",                 null,                 \"Agency\",                 \"19801\",                 \"Annual\",                 \"300000\",                 \"2015-09-02 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100004307782\",                 \"90131122\",                 \"HA_ProposalUpdate\",                 \"SK498-RDOCNUM                                    \",                 \"Receipt not posted\",                 null,                 \"Agency\",                 \"12658\",                 \"Annual\",                 \"300000\",                 \"2015-09-02 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100008845151\",                 \"90159670\",                 \"HA_ProposalUpdate\",                 \"SK498-RDOCNUM                                    \",                 \"Receipt not posted\",                 null,                 \"Agency\",                 \"13922\",                 \"Annual\",                 \"300000\",                 \"2015-09-12 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"2100008204073\",                 \"90150827\",                 \"HA_ProposalUpdate\",                 \"SK498-RDOCNUM                                    \",                 \"Receipt not posted\",                 null,                 \"Direct\",                 \"1694\",                 \"Annual\",                 \"1000000\",                 \"2015-09-04 00:00:00.0\",                 \"HA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008843032\",                 \"17871237\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Reqd proof not establish\",                 null,                 \"HDFC Bank\",                 \"99000\",                 \"Annual\",                 \"693000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100000164036\",                 \"17691206\",                 \"NEFT_Bank\",                 \"Z717\",                 \"S2081-BANKACOUNT                                  HFDC Bnk Acc:14 Dgt reqd0\",                 null,                 \"HDFC Bank\",                 \"15000\",                 \"Annual\",                 \"150000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008838148\",                 \"17877299\",                 \"SI/ECS_Bank\",                 \"E186\",                 \"S2081-BANKKEY                                     Field must be entered   0\",                 null,                 \"Agency\",                 \"30000\",                 \"Annual\",                 \"257666\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008839112\",                 \"17871517\",                 \"SI/ECS_Bank\",                 \"E186\",                 \"S2081-BANKKEY                                     Field must be entered   0\",                 null,                 \"Agency\",                 \"24155\",                 \"Annual\",                 \"152090\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008847142\",                 \"17877784\",                 \"SI/ECS_Bank\",                 \"E186\",                 \"S2081-BANKKEY                                     Field must be entered   0\",                 null,                 \"Agency\",                 \"65050\",                 \"Annual\",                 \"500000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008784991\",                 \"17859272\",                 \"SI/ECS_Bank\",                 \"E186\",                 \"S2081-BANKKEY                                     Field must be entered   0\",                 null,                 \"Agency\",                 \"24155\",                 \"Half Yearly\",                 \"456993\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008014559\",                 \"17877122\",                 \"SI/ECS_Bank\",                 \"E186\",                 \"S2081-BANKKEY                                     Field must be entered   0\",                 null,                 \"Agency\",                 \"12000\",                 \"Annual\",                 \"90546\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100009211092\",                 \"17877062\",                 \"SI/ECS_Bank\",                 \"E186\",                 \"S2081-BANKKEY                                     Field must be entered   0\",                 null,                 \"Direct\",                 \"25000\",                 \"Annual\",                 \"250000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008052445\",                 \"17838467\",                 \"LA_ProposalUpdate\",                 \"TL01\",                 \"S5004-AGNTSEL                                     Agent Black Lst         0\",                 null,                 \"HDFC Bank\",                 \"49999\",                 \"Annual\",                 \"349993\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100004398777\",                 \"17762172\",                 \"LA_ProposalUpdate\",                 \"JL93\",                 \"S5004-AGNTSEL                                     Agent not Auth for Prod 0\",                 null,                 \"HDFC Bank\",                 \"60000\",                 \"Annual\",                 \"600000\",                 \"2015-09-01 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008015628\",                 \"17830435\",                 \"LA_ProposalUpdate\",                 \"JL93\",                 \"S5004-AGNTSEL                                     Agent not Auth for Prod 0\",                 null,                 \"HDFC Bank\",                 \"30000\",                 \"Annual\",                 \"210000\",                 \"2015-08-28 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100000171866\",                 \"17700870\",                 \"LA_ProposalUpdate\",                 \"JL93\",                 \"S5004-AGNTSEL                                     Agent not Auth for Prod 0\",                 null,                 \"Agency\",                 \"9998\",                 \"Annual\",                 \"4000000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100000160236\",                 \"17686386\",                 \"LA_ProposalUpdate\",                 \"JL93\",                 \"S5004-AGNTSEL                                     Agent not Auth for Prod 0\",                 null,                 \"Agency\",                 \"22329\",                 \"Annual\",                 \"5000000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100004497124\",                 null,                 \"LA_ProposalSetup\",                 \"E475\",                 \"S5004-AGNTSEL                                     Agent not current       0\",                 null,                 \"HDFC Bank\",                 \"5032\",                 \"Annual\",                 \"30726\",                 \"2015-09-14 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100004494813\",                 null,                 \"LA_ProposalSetup\",                 \"E487\",                 \"S5004-BILLCD                                      REN DD not for MOP/FREQ 0\",                 null,                 \"Direct\",                 \"8333\",                 \"Monthly\",                 \"1000000\",                 \"2015-07-26 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-01 00:00:00.0\"             ],             [                 \"1100004472605\",                 null,                 \"LA_ProposalSetup\",                 \"E484\",                 \"S5004-MOP                                         MOP/FREQ Not in T5689   0\",                 null,                 \"Direct\",                 \"25000\",                 \"Annual\",                 \"175000\",                 \"2015-07-26 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-08-29 00:00:00.0\"             ],             [                 \"1100008128474\",                 null,                 \"LA_ProposalSetup\",                 \"E186\",                 \"S5004-ZBANCNUM                                    Field must be entered   0\",                 null,                 \"HDFC Securities\",                 \"14493\",                 \"Annual\",                 \"62538\",                 \"2015-08-31 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100004388938\",                 \"17760175\",                 \"LA_ProposalUpdate\",                 \"E562\",                 \"S5123-PREM-CESS-DATE                              Prem age out of range   0\",                 null,                 \"HDFC Bank\",                 \"21465\",                 \"Annual\",                 \"7000000\",                 \"2015-09-14 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100000358089\",                 null,                 \"LA_ProposalSetup\",                 \"E563\",                 \"S5123-PREM-CESS-TERM                              Prem term out of range  0\",                 null,                 \"HDFC Bank\",                 \"30000\",                 \"Annual\",                 \"300000\",                 \"2015-06-30 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100000263326\",                 \"17820160\",                 \"LA_ProposalSetup\",                 \"E519\",                 \"S5123-RISK-CESS-DATE                              Risk age out of range   0\",                 null,                 \"HDFC Bank\",                 \"99000\",                 \"Annual\",                 \"693000\",                 \"2015-07-04 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1200000163196\",                 null,                 \"LA_ProposalSetup\",                 \"E551\",                 \"S5123-RISK-CESS-TERM                              Risk term out of range  0\",                 null,                 \"Online\",                 \"9714\",                 \"Half Yearly\",                 \"15000000\",                 \"2015-09-11 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100005334753\",                 null,                 \"LA_ProposalSetup\",                 \"E416\",                 \"S6326-SINGLE-PREMIUM                              Sum ins < minimum limit 0\",                 null,                 \"HDFC Bank\",                 \"25000\",                 \"Annual\",                 \"168000\",                 \"2015-08-04 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-10 00:00:00.0\"             ],             [                 \"1100009218297\",                 null,                 \"LA_ProposalSetup\",                 \"Z613\",                 \"SK420-ZCHNFLD                                     Brn/chn code nt availble0\",                 null,                 \"Broca\",                 \"96618\",                 \"Annual\",                 \"470355\",                 \"2015-09-14 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100008788792\",                 null,                 \"LA_ProposalSetup\",                 \"Z618\",                 \"SK420-ZFOSFLD                                     Mst be num & Alphbt only0\",                 null,                 \"Broca\",                 \"96617\",                 \"Annual\",                 \"749802\",                 \"2015-09-14 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ],             [                 \"1100000377045\",                 \"17721301\",                 \"LA_PolicyIssuance\",                 \"    \",                 \"Sum Ins limit > DOGH SAR\",                 null,                 \"HDFC Bank\",                 \"24155\",                 \"Annual\",                 \"148336\",                 \"2015-07-24 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-02 00:00:00.0\"             ],             [                 \"1100000093115\",                 \"17674749\",                 \"LA_ProposalSetup\",                 \"E767\",                 \"ZNA-CRT-BO-ERROR-CODE                             Invalid policy status   0\",                 null,                 \"Agency\",                 \"24123\",                 \"Annual\",                 \"10000000\",                 \"2015-09-09 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-11 00:00:00.0\"             ],             [                 \"1100000138458\",                 \"17671802\",                 \"264379-LA_DataCapture\",                 \"External Service\",                 \"commonj.connector.runtime.DataBindingException: java.lang.IllegalArgumentException: IWAA0127E: Value '1100000095757' is outside the valid range for parameter bgenSj5b9Zsumass.  It must be between 0 and 9999999999.\",                 null,                 \"Agency\",                 \"57930\",                 \"Annual\",                 \"20000000\",                 \"2015-09-03 00:00:00.0\",                 \"LA-FinalSetup\",                 \"2015-09-10 00:00:00.0\"             ],             [                 \"1100000155160\",                 \"17722641\",                 null,                 null,                 null,                 null,                 \"HDFC Bank\",                 \"241546\",                 \"Annual\",                 \"1833366\",                 null,                 null,                 null             ],             [                 \"1100009192462\",                 null,                 null,                 \"EXCEPTION\",                 null,                 null,                 \"Agency\",                 \"99999\",                 \"Annual\",                 \"699993\",                 \"2015-09-12 00:00:00.0\",                 \"LA-InitialSetup\",                 \"2015-09-14 00:00:00.0\"             ]         ],         \"columnNameLst\": [             \"Application Number\",             \"Proposal Number\",             \"TEBT Process\",             \"LA ERROR_CD\",             \"LA ERROR_DESC\",             \"Assigned To\",             \"CHANNEL\",             \"PREMIUM_AMT\",             \"FREQUENCY\",             \"SUM_ASSURED\",             \"First Reported Date\",             \"RECORD_CREATED_BY TEBT Process\",             \"HE Record Created Date\"         ]     },     \"status\": \"success\",     \"date\": \"Sep 14, 08:42 PM\",     \"key\": \"function-handle-error\" }");
				JSONObject output = new JSONObject();
				output.put("msg", "success");
				output.put("table", table);
				logger.info("outputs:: "+output.toString(), className);
				response.setContentType("application/json");
			    response.setCharacterEncoding("UTF-8");	
			    response.getWriter().write(output.toString());
			} catch (Exception e) {
				logger.error("IN Exception:: SimplifyDashboardController - POST > viewDetails::"+e.getLocalizedMessage(), className);
				e.printStackTrace();
			}
//			logger.info("output:: "+output.toString(), className);			
		} else if ("utility".equals(action)) {
			String operation = request.getParameter("operation");
			if(("export-xls").equals(operation)) {
				logger.info("export-xls", className);
				DatabasePropertyReader reader = new DatabasePropertyReader();
				try {
					JSONObject data = new JSONObject( (String)request.getParameter("data"));
					JSONObject value = data.getJSONObject("value");
					DataHandler dataHandler = new DataHandler();
					String reportName = data.getString("key");
					String outputDir = reader.getWorkDir()+reportName+".xls";
					dataHandler.generateXLS(value.getJSONArray("columnNameLst"), value.getJSONArray("recordLst"), reportName,outputDir);
					JSONObject output = new JSONObject();
					output.put("status", "success");
					output.put("reportName", reportName);
					output.put("workdir", reader.getWorkDir());
					response.setContentType("application/json");
				    response.setCharacterEncoding("UTF-8");	
				    response.getWriter().write(output.toString());
					/*RequestDispatcher dispatcher = request.getRequestDispatcher("pages/download.jsp?report="+reportName+"&workdir="+ reader.getWorkDir());
					dispatcher.forward(request, response);*/
				} catch (Exception e) {
					e.printStackTrace();
				}
				
			}
			
		} 
	}

}
